<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:FolderCreator.Ui.ViewModels"
        xmlns:conv="clr-namespace:FolderCreator.Ui.Converters"
        mc:Ignorable="d"
        x:Class="FolderCreator.Ui.Views.MainWindow"
        Title="Create Folder"
        Width="720" Height="520"
        Background="{DynamicResource AppBg}"
        Foreground="{DynamicResource AppFg}">
  <Window.KeyBindings>
    <KeyBinding Gesture="Enter"
                Command="{Binding CreateCommand}"/>
    <KeyBinding Gesture="Meta+O"
                Command="{Binding BrowseBaseDirectoryCommand}"/>
  </Window.KeyBindings>

  <Design.DataContext>
    <vm:MainWindowViewModel/>
  </Design.DataContext>

  <ScrollViewer>
    <StackPanel Margin="28" Spacing="18">

      <TextBlock Text="Create Folder Tool"
                 FontSize="26"
                 FontWeight="SemiBold"/>

      <!-- Base Directory -->
      <StackPanel Spacing="8">
        <TextBlock Text="Base Directory" Opacity="0.85"/>
        <DockPanel LastChildFill="True">
          <Button DockPanel.Dock="Right"
                  Content="Browse…"
                  Classes="primary"
                  Margin="10,0,0,0"
                  Command="{Binding BrowseBaseDirectoryCommand}"/>
          <TextBox Text="{Binding BaseDirectory}"
                   IsReadOnly="True"
                   Watermark="Select a folder…"/>
        </DockPanel>
      </StackPanel>

      <!-- Main Folder -->
      <StackPanel Spacing="8">
        <TextBlock Text="Primary Folder Name" Opacity="0.85"/>
        <TextBox Text="{Binding MainFolderName, UpdateSourceTrigger=PropertyChanged}"
                 Watermark="e.g., Project Assets"/>
      </StackPanel>

      <!-- Subfolders -->
      <StackPanel Spacing="10">
        <DockPanel LastChildFill="True">
          <TextBlock Text="Subfolders" FontSize="16" FontWeight="SemiBold"/>
          <Button DockPanel.Dock="Right"
                  Content="+ Add Subfolder"
                  Command="{Binding AddSubfolderCommand}"
                  Classes="ghost"/>
        </DockPanel>

        <ItemsControl ItemsSource="{Binding Subfolders}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <DockPanel>
                <Button DockPanel.Dock="Right"
                        Content="Remove"
                        Classes="danger"
                        Margin="10,0,0,0"
                        Command="{Binding DataContext.RemoveSubfolderCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                        CommandParameter="{Binding}"/>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                         Watermark="Subfolder name"/>
              </DockPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>

      <!-- Preview -->
      <StackPanel Spacing="8">
        <TextBlock Text="Preview" FontSize="16" FontWeight="SemiBold"/>
        <Border CornerRadius="10"
                Padding="12"
                BorderBrush="#3A4A59"
                BorderThickness="1">
          <StackPanel Spacing="8">
            <TextBlock Text="Root path"
                       FontWeight="SemiBold"
                       Opacity="0.85"/>
            <TextBlock Text="{Binding PreviewRootPath}"
                       TextWrapping="Wrap"/>
            <TextBlock Text="Folders to create"
                       FontWeight="SemiBold"
                       Margin="0,6,0,0"
                       Opacity="0.85"/>
            <ItemsControl ItemsSource="{Binding PreviewItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding .}"
                             TextWrapping="Wrap"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>
      </StackPanel>

      <!-- Status -->
      <Border IsVisible="{Binding StatusMessage, Converter={x:Static conv:StringConverters.NotNullOrEmpty}}"
              Background="{Binding IsSuccess, Converter={x:Static conv:BoolConverters.SuccessToBg}}"
              CornerRadius="10"
              Padding="12">
        <TextBlock Text="{Binding StatusMessage}"/>
      </Border>

      <!-- Create -->
      <DockPanel>
        <Button DockPanel.Dock="Right"
                Content="Create Folders"
                Command="{Binding CreateCommand}"
                Classes="primary"
                Width="160"
                Height="40"/>
        <Button DockPanel.Dock="Right"
                Content="Open Folder"
                Command="{Binding OpenLastCreatedCommand}"
                Classes="ghost"
                Margin="0,0,10,0"
                Width="130"
                Height="40"/>
      </DockPanel>

    </StackPanel>
  </ScrollViewer>
</Window>
